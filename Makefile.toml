# project tasks
[tasks.api-run]
workspace = false
env = { RUST_LOG="debug" }
install_crate = "cargo-shuttle"
command = "cargo"
args = ["shuttle", "run"]

[tasks.front-serve]
workspace = false
cwd = "./front"
install_crate = "dioxus-cli"
command = "dioxus"
args = ["serve"]


# [tasks.front]
# workspace = false
# script_runner = "@shell"
# script = '''
# rm -rf static
# mkdir static
# cd front
# dioxus build --release
# mkdir -p dist/assets/images
# cp -a src/images/* dist/assets/images/
# cp -r dist/* ../static
# rm -rf dist
# '''

# general tasks
[tasks.clippy]
workspace = false
install_crate = "cargo-clippy"
command = "cargo"
args = ["clippy"]

[tasks.format]
clear = true
workspace = false
install_crate = "rustfmt"
command = "cargo"
args = ["fmt", "--all", "--", "--check"]

# book tasks
[tasks.book-readme]
workspace = false
script_runner = "@shell"
script = '''
cp README.md docs/src/README.md
sed -i 's/\.\/docs\/src\//\.\//g' docs/src/README.md
'''

[tasks.book-preprocessors]
workspace = false
script_runner = "@shell"
script = '''
cargo install mdbook-mermaid
cargo install mdbook-admonish
cargo install mdbook-toc
'''

[tasks.book-build-ci]
workspace = false
run_task = { name = [ "book-readme", "book-build-inner"] }

[tasks.book-build]
workspace = false
run_task = { name = ["book-preprocessors", "book-readme", "book-build-inner"] }

[tasks.book-serve]
workspace = false
run_task = { name = ["book-preprocessors", "book-readme", "book-serve-inner"] }

[tasks.book-build-inner]
workspace = false
cwd = "./docs"
install_crate = "mdbook"
command = "mdbook"
args = ["build"]

[tasks.book-serve-inner]
workspace = false
cwd = "./docs"
install_crate = "mdbook"
command = "mdbook"
args = ["serve"]

